# U.T. 5 A-Frame
- [U.T. 5 A-Frame](#ut-5-a-frame)
  - [El framework en profundidad](#el-framework-en-profundidad)
    - [Instalación y configuración incial](#instalación-y-configuración-incial)
      - [Uso de sitos externos](#uso-de-sitos-externos)
      - [Uso de nuestro propio servidor HTTP / HTTPS](#uso-de-nuestro-propio-servidor-http--https)
    - [Primeros pasos en la creación de una escena](#primeros-pasos-en-la-creación-de-una-escena)


## El framework en profundidad
https://jgbarah.github.io/aframe-playground/
### Instalación y configuración incial
En general es preferible acceder a los fuentes a través de un servidor web, y en concreto que tenga configurada una conexión segura (https) ya que algunas funcionalidades solo son accesibles a través de dicho protocolo.

A continuación crearemos el fichero html en el que cargaremos la librería aframe desde un recurso propio o externo, a través de la etiqueta \<script>

#### Uso de sitos externos
- GitHub. Se puede usar GitHub como servidor a través de sus repositorios. si el repositorio es algo del tipo https://github.com/user/repo se accederá vía http seguro desde https://user.github.io/repo.

- GitLab. Es similar a Github. Si el repositorio es https://gitlab.com/user/repo accederemos vía HTTPS con https://user.gitlab.io/repo.
- 
#### Uso de nuestro propio servidor HTTP / HTTPS
- webpack-dev-server. 
- XAMP XAMPP es una distribución de Apache completamente gratuita y fácil de instalar que contiene MariaDB, PHP y Perl. El paquete de instalación de XAMPP ha sido diseñado para ser increíblemente fácil de instalar y usar. https://www.apachefriends.org/es/index.html
  
### Primeros pasos en la creación de una escena
 Crearemos una escena con una caja, una esfera, un cilindro encima de un planlo, con el cielo en gris. Se utilizarán algunas imágenes para que se visualicen dentro de cada objeto.

Para poder ejecutar dicha aplicación, es necesario tener la siguiente estructura de directorios u ficheros en el directorio correspondiente del servidor (generalmente httpd en XAMP).

    assets
    |-js
      |- aframe.min.js
    |- imgs
      |- bands.jpg
      |- molinos-bw.jpg
      |- window.jpg
      |- soil.jpg
    03
    |- 01.html

Una aplicación A-Frame puede ser desarrollada desde un fichero HTML plano sin instalar nada. La mejor manera de probar A-Frame es crear dentro de https un fichero html y dentro de la etiqueta \<head> cargar la librería A-Frame bien como un cdn externo o como recurso propio.

    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

    o

    <script src="../assets/js/aframe.min.js"></script>

**01.html**
El primer paso es cargar la librería desde un recurso propio o externo, a través de la etiqueta \<script>.
A continuación la creación de la escena es simple, dentro del \<body>, se crea una etiqueta \<a-scene> con el contenido de la misma. Cada objeto es una etiqueta distinta y cada etiqueta establece las propiedades necesarias, entre las que destacan la posicion, la rotación, la escala y una imagen a mostrar dentro de la forma.

*Fuentes*

>     <!DOCTYPE html>
>     <html>
>       <head>
>         <meta charset="UTF-8">
>         <!--    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script> -->
>         <script src="../assets/js/aframe.min.js"></script>
>       </head>
>       <body>
>         <a-scene background="color: grey">
>           <a-box position="3.5 1 -3" rotation="0 90 0" scale="2 2 2" src="../assets/imgs/molinos-bw.jpg"></a-box> 
>           <a-sphere position="0 1.25 -5" radius="1.25" src="../assets/imgs/soil.jpg"></a-sphere>
>           <a-cylinder position="1 1.25 -3" radius="0.5" height="2.5" src="../assets/imgs/bands.jpg"></a-cylinder>
>           <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" src="../assets/imgs/window.jpg"></a-plane>
>         </a-scene>
>       </body>
>     </html>


**02.html**
En este ejemplo hemos cambiado la imágen de la esferan proyectándose 360º en vez de ser una textura, para esto se hace una fotografía con una cámara de 360º. 
Se ha añadido una animación en la caja, se mueve repetidamente ademante y atrás.

    animation="property: position; to: 5.5 1 -5;
                            dir: alternate; dur: 4000;
                            loop: true"

Se ponen varias luces para una mejor iluminación y un color de fondo.

    <a-light type="ambient" color="grey"></a-light>
    <a-light type="point" intensity="2" position="-2 2 4"></a-light>

También se reestructuran los recursos, agrupándolos ahora en una etiqueta <a-assets> todos en vez de estar dispersos por cada elmento. Esto implica que la propiedad **src** cambia de una url a un id (#nombre). La ventaja es que se hace una carga inicial de todos los recursos sin interferiz con la escena.

*Fuentes*

>     <body>
>       <a-scene background="color: grey">
>          <a-assets>
>            <img id="molinos" src="../assets/imgs/molinos-bw.jpg">
>            <img id="soil" src="../assets/imgs/soil.jpg">
>            <img id="bands" src="../assets/imgs/bands.jpg">
>            <img id="plaza-360" src="../assets/imgs/plaza-360.jpg">
>          </a-assets>
>          <a-box position="3.5 1 -3" rotation="0 90 0" scale="2 2 2"    
>                src="#molinos"
>                animation="property: position; to: 5.5 1 -5;
>                            dir: alternate; dur: 4000;
>                            loop: true">
>          </a-box>
>          <a-sphere position="0 1.25 -5" radius="1.25"  src="#plaza-360"></a-sphere>
>          <a-cylinder position="1 1.25 -3" radius="0.5" height="2.5" src="#bands"></a-cylinder>
>          <a-plane position="0 0 -4" rotation="-90 0 0" width="8" height="4" repeat="4 2" src="#soil"></a-plane>
>           <a-light type="ambient" color="grey"></a-light>
>          <a-light type="point" intensity="2" position="-2 2 4"></a-light>
>        </a-scene>
>     </body>

**03.html**
Dibujar texto en 3D es difícil. En 2D crear texto es una acción básica porque el motor de renderizado está optimizado para ese tipo de trabajo. Pero en 3D tenemos que lidiar con otros problemas. Para poder escribir texto en 3D existen difererentes métodos, entre los que encontramos:
- Texto 3D Text
- Materiales HTML (DOM-to-Canvas-to-Texture)
- Texturas (imágenes)

Añadimos texto a nuestro fichero indicando sus propiedades y la fuente que deseamos usar, en esta caso descargada en nuestros recursos. 

    <a-text value="Just a simple test" color="red"
          position="-3.5 0.5 -2" rotation="-45 30 0" scale="2.5 2.5 2.5"
                font="../assets/fonts/Roboto-msdf.json"></a-text>

También se añade una cámara a la escena, estableciendo el punto de vista desde el que el actor la visualizará. Para poder crearla hay que encerrarla dentro de una entidad para poder sobrescribir la posición y la rotación.

    <a-entity position="-3 2 1" rotation="0 -25 0">
      <a-camera></a-camera>
    </a-entity>

Estas líneas posicionan la cámara 3 unidades a la izquierda, 2 arriba y 1 junto al origen, apuntando 25º hacia la derecha.

*Fuentes*

>      <a-scene background="color: grey">
>        <a-assets>
>          <img id="molinos" src="../assets/imgs/molinos-bw.jpg">
>          <img id="soil" src="../assets/imgs/soil.jpg">
>          <img id="bands" src="../assets/imgs/bands.jpg">
>        </a-assets>
>
>        <a-box position="3.5 1 -3" rotation="0 90 0" scale="2 2 2" src="#molinos"
>              animation="property: position; to: 5.5 1 -5;
>                          dir: alternate; dur: 4000;
>                          loop: true">
>        </a-box>
>        <a-sphere position="-2 1.25 -5" radius="1.25" src="#soil"></a-sphere>
>        <a-cylinder position="1 1.25 -3" radius="0.5" height="2.5" src="#bands"></a-cylinder>-->
>        <a-plane position="0 0 -4" rotation="-90 0 0" width="10" height="4" repeat="4 2" src="#soil"></a-plane>
>        <a-text value="Just a simple test" color="red"
>          position="-3.5 0.5 -2" rotation="-45 30 0" scale="2.5 2.5 2.5"
>                font="../assets/fonts/Roboto-msdf.json"></a-text>
>
>        <a-light type="ambient" color="grey"></a-light>
>        <a-light type="point" intensity="2" position="-2 2 4"></a-light>
>
>        <a-entity position="-3 1 1" rotation="0 -25 0">
>          <a-camera></a-camera>
>        </a-entity>
>      </a-scene>

**04.html**
El siguiente paso añade algo de javascript a la escena modificando el comportamiento de la esfera cuando la señalamos con el cursos, en concreto crece de tamaño. Se hace a crando la etiqueta correspondiente al final del fichero dentro de la escena.

    <script>
      var sphere = document.querySelector('a-sphere');
      sphere.addEventListener('mouseenter', function () {
          sphere.setAttribute('scale', {x: 1.2, y: 1.2, z: 1.2});
      });
      sphere.addEventListener('mouseleave', function () {
          sphere.setAttribute('scale', {x: 1, y: 1, z: 1});
      });
    </script>


Como podemos comprobar es similar a lo que se hace en javascript tradicional a la hora de capturtar eventos en el DOM. El único truco, es que el cursor (círculo) que se añade funcionará como un ratón y será el desencadenate de los diferentes eventos: mouseenter y mouseleave.

Se añade otro tipo de texto a la escena, ahora en un plano.

    <a-entity>
        geometry="primitive: plane; width: 4; height: auto"
        position="0 3 -3"
        material="color: red"
        font="./assets/Roboto-msdf.json"
        text="value: This is another test"></a-entity>


*Fuentes*

>      <a-scene background="color: grey">
>          <a-assets>
>            <img id="molinos" src="../assets/imgs/molinos-bw.jpg">
>            <img id="soil" src="../assets/imgs/soil.jpg">
>            <img id="bands" src="../assets/imgs/bands.jpg">
>          </a-assets>
>
>          <a-box position="3.5 1 -3" rotation="0 90 0" scale="2 2 2"    
>                src="#molinos"
>                animation="property: position; to: 5.5 1 -5;
>                            dir: alternate; dur: 4000;
>                            loop: true">
>          </a-box>
>          <a-sphere position="-2 1.25 -5" radius="1.25" src="#soil"></a-sphere>
>          <a-cylinder position="1 1.25 -3" radius="0.5" height="2.5"  src="#bands"></a-cylinder>
>          <a-plane position="0 0 -4" rotation="-90 0 0" width="10" height="4" repeat="4 2" src="#soil"></a-plane>
>          <a-entity
>            geometry="primitive: plane; width: 4; height: auto"
>            position="0 3 -3"
>            material="color: red"
>            font="./assets/Roboto-msdf.json"
>            text="value: This is another test"></a-entity>
>
>          <a-light type="ambient" color="grey"></a-light>
>          <a-light type="point" intensity="2" position="-2 2 4"></a-light>
>
>          <a-entity position="-3 1 1" rotation="0 -25 0">
>            <a-camera>
>              <a-cursor></a-cursor>
>            </a-camera>
>          </a-entity>
>        </a-scene>
>
>        <script>
>          var sphere = document.querySelector('a-sphere');
>          sphere.addEventListener('mouseenter', function () {
>              sphere.setAttribute('scale', {x: 1.2, y: 1.2, z: 1.2});
>          });
>          sphere.addEventListener('mouseleave', function () {
>              sphere.setAttribute('scale', {x: 1, y: 1, z: 1});
>          });
>        </script>

**05.html**
Para un móvil, o un entrono de AR real hay que añadir algunas configuraciones más. En concreto se elimina el fondo.

>     <a-scene>

**06.html**
En vez de usar el cursor de posición (círculo), podemos usar el ratón, lo únco que tenemos que cambiar el la propiedad rayOrigin:

>      <a-entity position="-3 1 1" rotation="0 -25 0">
>        <a-camera cursor="rayOrigin:mouse">
>        </a-camera>
>      </a-entity>

**07.html**
Para trabajar correctamente con los periféricos de VR (Gafas y mandos) hay que añadir los controles de moviento. Para este fin, hay que utilizar otra librería más (A-frame-extras) que podemos descargar de https://github.com/n5ro/aframe-extras o https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/). Enconraremos controles de visión, controles láser, etc.

*Fuentes*

>     <!DOCTYPE html>
>     <html>
>      <head>
>        <meta charset="UTF-8">
>        <!--    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script> -->
>        <script src="../assets/js/aframe.min.js"></script>
>        <script src="//cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
>      </head>
>      <body>
>        <a-scene background="color: grey">
>          <a-assets>
>            <img id="molinos" src="../assets/imgs/molinos-bw.jpg">
>            <img id="soil" src="../assets/imgs/soil.jpg">
>            <img id="bands" src="../assets/imgs/bands.jpg">
>          </a-assets>
>
>          <a-box position="3.5 1 -3" rotation="0 90 0" scale="2 2 2" src="#molinos"
>                animation="property: position; to: 5.5 1 -5;
>                            dir: alternate; dur: 4000;
>                            loop: true">
>          </a-box>
>          <a-sphere position="-2 1.25 -5" radius="1.25" src="#soil"></a-sphere>
>          <a-cylinder position="1 1.25 -3" radius="0.5" height="2.5"
>                      src="#bands"></a-cylinder>
>          <a-plane position="0 0 -4" rotation="-90 0 0" width="10" height="4"
>                  repeat="4 2" src="#soil"></a-plane>
>          <a-entity
>            geometry="primitive: plane; width: 4; height: auto"
>            position="0 3 -3"
>            material="color: red"
>            font="./assets/Roboto-msdf.json"
>            text="value: This is another test"></a-entity>
>
>          <a-light type="ambient" color="grey"></a-light>
>          <a-light type="point" intensity="2" position="-2 2 4"></a-light>
>
>          <a-entity movement-controls="fly: true" position="-3 1 1" rotation="0 -25 0">
>            <a-entity camera position="0 1.6 0" look-controls></a-entity>
>            <a-entity cursor="rayOrigin:mouse"></a-entity>
>            <a-entity laser-controls="hand: right"></a-entity>
>          </a-entity>
>
>        </a-scene>
>
>        <script>
>        var sphere = document.querySelector('a-sphere');
>        sphere.addEventListener('mouseenter', function () {
>          sphere.setAttribute('scale', {x: 1.2, y: 1.2, z: 1.2});
>        });
>        sphere.addEventListener('mouseleave', function () {
>          sphere.setAttribute('scale', {x: 1, y: 1, z: 1});
>        });
>        </script>
>      </body>
>     </html>

**08.html**

 discovered that the equivalence between primitives and entities is not complete, and that there is nothing like a curvedimage primitive geometry. In fact, curvedimage is built based on cylinder. So, I built the equivalent to a curved image in three different ways: with a a-curvedimage primitive, with a cylinder primitive, and with an entity, using cylinder as the primitive geometry

 I also included some fog, which is a component of a-scene. The linear model worked well when I selected the appropriate far and near properties. When using fog, I can omit the a-sky element, since the “sky” will be just an accumulation of fog.


 TODO: https://aframe.io/docs/1.3.0/introduction/entity-component-system.html
 TODO: https://aframe.io/docs/1.3.0/core/entity.html
 TODO: https://aframe.io/docs/1.3.0/core/component.html

*Fuentes*

      <a-scene fog="type: linear; color: lightgrey; far: 10; near: 1" stats>
        <a-assets>
          <img id="soil" src="../assets/imgs/soil.jpg">
          <img id="bands" src="../assets/imgs/bands.jpg">
          <img id="window" src="../assets/imgs/window.jpg">
        </a-assets>

        <a-entity
            geometry="primitive: cylinder; height: 6.0; radius: 5;
              theta-length: 70; open-ended: true"
            position="0 3 -4"
            rotation="0 220 0"
            material="src: #window; side: double"></a-entity>
        <a-cylinder height="6.0" radius="5" theta-length="70" open-ended="true"
          side="double" position="0 3 -4" rotation="0 140 0"
          color="red"></a-cylinder>
        <a-curvedimage height="6.0" radius="5" theta-length="70"
          position="0 3 -4" rotation="0 60 0" src="#window"></a-curvedimage>

        <a-sphere position="-2 1.25 -5" radius="1.25" src="#soil"></a-sphere>
        <a-cylinder position="1 1.25 -3" radius="0.5" height="2.5" src="#bands"></a-cylinder>
        <a-plane position="0 0 -4" rotation="-90 0 0" width="15" height="6" repeat="4 2" src="#soil"></a-plane>

        <a-light type="ambient" color="grey"></a-light>
        <a-light type="point" intensity="2" position="-2 2 4"></a-light>
      </a-scene>



---
[Siguiente](ut_5_04.md)
